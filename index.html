<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vincular com Spotify</title>
  <style>
    :root {
      --spotify-green: #1DB954;
      --spotify-green-hover: #1ED760;
      --background-dark: #121212;
      --card-dark: #282828;
      --text-primary: #FFFFFF;
      --text-secondary: #B3B3B3;
      --error-red: #F44336;
      --info-blue: #2196F3;
    }

    /* Reset b√°sico e estilo do body */
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: var(--background-dark);
      font-family: 'Helvetica Neue', Arial, sans-serif;
      color: var(--text-primary);
      padding: 20px;
      box-sizing: border-box;
    }

    /* Card principal */
    .container {
      background-color: var(--card-dark);
      border-radius: 12px;
      padding: 40px;
      width: 100%;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    h1 {
      font-size: 24px;
      margin-top: 0;
      margin-bottom: 10px;
    }

    p {
      color: var(--text-secondary);
      margin-bottom: 30px;
    }
    
    /* Bot√£o de login */
    #login-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      padding: 14px 28px;
      font-size: 16px;
      border: none;
      border-radius: 50px;
      background-color: var(--spotify-green);
      color: var(--text-primary);
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease, transform 0.1s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    #login-button:hover {
      background-color: var(--spotify-green-hover);
      transform: scale(1.03);
    }
    
    #login-button svg {
      width: 24px;
      height: 24px;
    }

    /* Painel de informa√ß√µes din√¢mico */
    #info-panel {
      margin-top: 30px;
      padding: 20px;
      border-radius: 8px;
      word-break: break-word;
      text-align: left;
      transition: background-color 0.3s ease;
      min-height: 50px;
    }
    
    #info-panel.initial {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: var(--text-secondary);
      background-color: rgba(0,0,0,0.2);
    }
    
    #info-panel.success {
      background-color: rgba(29, 185, 84, 0.1);
    }

    #info-panel.error {
      background-color: rgba(244, 67, 54, 0.1);
      color: var(--error-red);
    }

    /* Estilos de dados do perfil */
    .profile-data strong {
      color: var(--text-secondary);
      display: block;
      margin-bottom: 2px;
      font-size: 12px;
      text-transform: uppercase;
    }
    .profile-data span { color: var(--text-primary); font-size: 16px; }
    .profile-data div { margin-bottom: 15px; }
    
    .token-display {
        font-family: monospace;
        font-size: 11px;
        background-color: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 4px;
        word-break: break-all;
        color: var(--text-secondary);
        max-height: 80px;
        overflow-y: auto;
    }

    /* --- ESTILOS DAS NOTIFICA√á√ïES --- */
    #notification-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .notification {
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease forwards, fadeOut 0.5s ease 3.5s forwards;
    }
    
    .notification.info { background-color: var(--info-blue); }
    .notification.success { background-color: var(--spotify-green); }
    .notification.error { background-color: var(--error-red); }

    @keyframes slideIn {
        from { transform: translateX(120%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; transform: translateX(20%); }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Vincule sua conta Spotify</h1>
    <p>Autorize nosso aplicativo a acessar seu perfil para continuar.</p>
    
    <button id="login-button">
      <svg fill="currentColor" viewBox="0 0 168 168"><path d="m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.93-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"/></svg>
      Entrar com Spotify
    </button>
    
    <div id="info-panel" class="initial">Vincule sua conta para ver seus dados.</div>
  </div>

  <div id="notification-container"></div>

 <script>
  // --- Configura√ß√£o ---
  const clientId = '562ee2fb1b8047aa8d8f978a0b09a4fa'; // Substitua pelo seu Client ID
  const scopes = 'user-read-private user-read-email user-top-read';

  // FIXAR redirectUri, tem que bater exatamente com o que est√° cadastrado no Spotify Dashboard
  const redirectUri = 'https://html-nexus.vercel.app/'; // üîë fixo para o Vercel

  // --- Seletores ---
  const loginButton = document.getElementById('login-button');
  const infoPanel = document.getElementById('info-panel');
  const notificationContainer = document.getElementById('notification-container');

  // --- Fun√ß√£o de notifica√ß√µes ---
  function showNotification(message, type = 'info', duration = 4000) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    notificationContainer.appendChild(notification);
    setTimeout(() => notification.remove(), duration);
  }

  // --- Login Spotify ---
  function loginWithSpotify() {
    showNotification('Redirecionando para o Spotify...', 'info');

    const authEndpoint = 'https://accounts.spotify.com/authorize';
    const authUrl = `${authEndpoint}?response_type=token&client_id=${clientId}&scope=${encodeURIComponent(scopes)}&redirect_uri=${encodeURIComponent(redirectUri)}&show_dialog=true`;

    // Redireciona para o modal de autoriza√ß√£o do Spotify
    window.location.href = authUrl;
  }

  // --- Buscar perfil do usu√°rio ---
  async function getUserProfile(token) {
    showNotification('Autorizado! Carregando seu perfil...', 'success');

    try {
      const response = await fetch('https://api.spotify.com/v1/me', {
        headers: { 'Authorization': `Bearer ${token}` }
      });

      if (!response.ok) throw new Error(`API Error: ${response.status}`);
      const data = await response.json();
      displayUserProfile(data, token);

    } catch (err) {
      console.error('Falha ao buscar perfil:', err);
      showNotification('N√£o foi poss√≠vel carregar seu perfil.', 'error');
      displayError('Ocorreu um erro ao buscar seus dados. O token pode ter expirado ou a API est√° indispon√≠vel.');
    }
  }

  // --- Exibir dados do usu√°rio ---
  function displayUserProfile(profileData, token) {
    showNotification(`Bem-vindo(a), ${profileData.display_name}!`, 'success');
    loginButton.style.display = 'none';
    infoPanel.className = 'success';
    infoPanel.innerHTML = `
      <div class="profile-data">
        <h3>‚úÖ Conectado com sucesso!</h3>
        <div><strong>Usu√°rio:</strong><span>${profileData.display_name || 'N/A'}</span></div>
        <div><strong>Email:</strong><span>${profileData.email || 'N/A'}</span></div>
        <div><strong>Pa√≠s:</strong><span>${profileData.country || 'N/A'}</span></div>
        <div><strong>Token de Acesso:</strong><div class="token-display">${token}</div></div>
      </div>`;
  }

  function displayError(message, details = '') {
    infoPanel.className = 'error';
    infoPanel.innerHTML = `<strong>‚ùå Erro:</strong> ${message} ${details ? `<br><small>${details}</small>` : ''}`;
  }

  // --- Inicializa√ß√£o ---
  window.onload = () => {
    const urlParams = new URLSearchParams(window.location.search);
    const hashParams = new URLSearchParams(window.location.hash.replace('#', ''));
    const accessToken = hashParams.get('access_token');
    const error = urlParams.get('error');

    if (error) {
      showNotification('A autoriza√ß√£o foi negada.', 'error');
      displayError('O acesso foi negado pelo usu√°rio no Spotify.');
      return;
    }

    if (accessToken) {
      // Limpa hash da URL
      history.replaceState(null, null, window.location.pathname);
      getUserProfile(accessToken);
    }
  };

  loginButton.addEventListener('click', loginWithSpotify);
</script>

</body>
</html>
